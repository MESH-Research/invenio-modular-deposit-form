{#
  This file is part of Invenio Modular Deposit Form

  Copyright (C) 2023-2024 Mesh Research.

  This is an extension for the InvenioRDM platform and was adapted from
  files in InvenioRDM. InvenioRDM is:

  Copyright (C) 2020 CERN.
  Copyright (C) 2020 Northwestern University.

  Invenio App RDM and Invenio Modular Deposit Form are free software; you
  can redistribute and/or modify them under the terms of the MIT License;
  see LICENSE file for more details.
#}
{%- if not record.is_published and record.versions.index and record.versions.index > 1 %}
  {%- set title = _("New version") %}
{%- elif not record.is_published %}
  {%- set title = _("New upload") %}
{% else %}
  {%- set title = _("Edit upload") %}
{%- endif %}
{%- extends config.BASE_TEMPLATE %}

{# Provide user profile data to form #}
{% set cu = current_userprofile %}
{% set profile_fields = config.get("ACCOUNTS_USER_PROFILE_SCHEMA").fields.keys() %}
{% set cu_dict = {'id': cu.id if cu.id else ""} %}
{% for f in profile_fields %}
  {% set _ = cu_dict.update({f: cu["user_profile"][f] if cu["user_profile"][f] else ""}) %}
{% endfor %}

{%- block page_body %}
  <div id="deposit-form"
    data-common-fields='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_COMMON_FIELDS", {}) | tojson }}'
    data-community-term='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_COMMUNITY_TERM", "community") }}'
    data-current-userprofile='{{ cu_dict | tojson }}'
    data-default-field-values='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_DEFAULT_FIELD_VALUES", {}) | tojson }}'
    data-default-resource-type='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_DEFAULT_RESOURCE_TYPE", {}) | tojson }}'
    data-depositConfig='{{ forms_config or {} | tojson }}'
    data-description-modifications='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_DESCRIPTION_MODIFICATIONS", {}) | tojson }}'
    data-extra-required-fields='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_EXTRA_REQUIRED_FIELDS", {}) | tojson }}'
    data-fields-by-type='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_FIELDS_BY_TYPE", {}) | tojson }}'
    data-files='{{ files or {} | tojson }}'
    data-help-text-modifications='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_HELP_TEXT_MODIFICATIONS", {}) | tojson }}'
    data-icon-modifications='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_ICON_MODIFICATIONS", {}) | tojson }}'
    data-label-modifications='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_LABEL_MODIFICATIONS", {}) | tojson }}'
    data-permissions='{{ permissions or {} | tojson }}'
    data-pids-config-overrides='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_PIDS_OVERRIDES", {}) | tojson }}'
    data-placeholder-modifications='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_PLACEHOLDER_MODIFICATIONS", {}) | tojson }}'
    data-preselected-community='{{ preselectedCommunity or {} | tojson }}'
    data-previewable-extensions='{{ "" | previewable_extensions | tojson }}'
    data-priority-field-values='{{ config.get("INVENIO_MODULAR_DEPOSIT_FORM_PRIORITY_FIELD_VALUES", {}) | tojson }}'
    data-record='{{ record or {} | tojson }}'
  ></div>
{%- endblock page_body %}

{%- block javascript %}
    {{ super() }}
    {{ webpack['invenio-modular-deposit-form.js'] }}
{%- endblock %}

